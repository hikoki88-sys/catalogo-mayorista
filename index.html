<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generador de CatÃ¡logo Mayorista</title>

<style>
body{font-family:Arial, sans-serif;background:#f5f5f5;padding:20px}
h1{text-align:center}
.card{background:#fff;padding:15px;border-radius:8px;max-width:540px;margin:0 auto}
label{display:block;margin-top:10px;font-weight:bold}
input{width:100%;padding:8px;margin-top:5px}
button{margin-top:12px;width:100%;padding:12px;font-size:15px;border-radius:6px;border:none;cursor:pointer}
.producto{border:1px solid #ddd;padding:10px;border-radius:6px;margin-top:15px}
.btn-pdf{background:#111;color:#fff}
.btn-wsp{background:#25D366;color:#fff}
.small{font-size:12px;color:#666;margin-top:8px}
</style>
</head>

<body>

<h1>CatÃ¡logo Mayorista</h1>

<div class="card">

  <label>ðŸ“· Logo del negocio (opcional)</label>
  <input type="file" id="logoInput" accept="image/*">

  <label>ðŸ“± NÃºmero WhatsApp (+51...)</label>
  <input type="text" id="wspNumero" placeholder="Ej: 51987654321">

  <label>ðŸ’¬ Mensaje de WhatsApp</label>
  <input type="text" id="wspMensaje" value="Hola, te envÃ­o mi catÃ¡logo mayorista. AvÃ­same cualquier consulta.">

  <div id="productos"></div>

  <button onclick="agregarProducto()">âž• Agregar Zapatilla</button>
  <button class="btn-pdf" onclick="generarPDF()">ðŸ“„ Generar PDF</button>
  <button class="btn-wsp" onclick="enviarWhatsApp()">ðŸŸ¢ Enviar por WhatsApp</button>

  <div class="small">* Funciona offline y online (GitHub Pages)</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let productos = [];
let logoData = null;

// Logo
document.getElementById("logoInput").addEventListener("change", e => {
  if(!e.target.files[0]) return;
  const r = new FileReader();
  r.onload = () => logoData = r.result;
  r.readAsDataURL(e.target.files[0]);
});

function agregarProducto(){
  const i = productos.length;
  productos.push({});

  const d = document.createElement("div");
  d.className = "producto";
  d.innerHTML = `
    <label>Foto</label>
    <input type="file" accept="image/*" onchange="productos[${i}].foto=this.files[0]">

    <label>Precio</label>
    <input onchange="productos[${i}].precio=this.value">

    <label>Calidad</label>
    <input onchange="productos[${i}].calidad=this.value">

    <label>Tallas</label>
    <input onchange="productos[${i}].tallas=this.value">
  `;

  document.getElementById("productos").appendChild(d);
}

function leerImagen(file){
  return new Promise(res => {
    const img = new Image();
    const r = new FileReader();
    r.onload = e => {
      img.onload = () => {
        const c = document.createElement("canvas");
        const maxW = 1700; // mÃ¡s resoluciÃ³n
        const scale = Math.min(1, maxW / img.width);
        c.width = img.width * scale;
        c.height = img.height * scale;
        const ctx = c.getContext("2d");
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "high";
        ctx.drawImage(img,0,0,c.width,c.height);
        res(c.toDataURL("image/jpeg",0.85)); // menos compresiÃ³n
      };
      img.src = e.target.result;
    };
    r.readAsDataURL(file);
  });
}

async function generarPDF(){
  if(productos.length === 0){ alert("Agrega productos"); return; }

  const jsPDF = window.jspdf.jsPDF;
  const pdf = new jsPDF("p","mm","a4");

  const yPos = [20, 150];
  let index = 0;

  for(let i=0;i<productos.length;i++){
    const p = productos[i];
    if(!p.foto) continue;

    if(index === 0 && i > 0) pdf.addPage();

    const img = await leerImagen(p.foto);
    const y = yPos[index];

    // mantener proporciÃ³n real (NO estirar)
    const imgProps = pdf.getImageProperties(img);
    const maxWidth = 170;
    const ratio = imgProps.width / imgProps.height;
    const imgHeight = maxWidth / ratio;
    pdf.addImage(img,"JPEG",20,y,maxWidth,imgHeight);
    pdf.setFontSize(13);
    pdf.text("Precio: " + (p.precio||""),25,y + imgHeight + 10);
    pdf.text("Calidad: " + (p.calidad||""),25,y + imgHeight + 20);
    pdf.text("Tallas: " + (p.tallas||""),25,y + imgHeight + 30);

    if(logoData){
      pdf.addImage(logoData,"JPEG",150,y+65,35,15);
    }

    index++;
    if(index === 2) index = 0;
  }

  pdf.save("catalogo_mayorista.pdf");
}

function enviarWhatsApp(){
  const num = document.getElementById("wspNumero").value.trim();
  if(!num){ alert("Ingresa nÃºmero WhatsApp"); return; }
  const msg = document.getElementById("wspMensaje").value;
  window.open(`https://wa.me/${num}?text=${encodeURIComponent(msg)}`,"_blank");
}

agregarProducto();
</script>

</body>
</html>
